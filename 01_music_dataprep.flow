{"metadata": {"version": 1, "disable_limits": false}, "nodes": [{"node_id": "99823cc7-ddf7-4660-a279-efe1ab225ade", "type": "SOURCE", "operator": "sagemaker.s3_source_0.1", "parameters": {"dataset_definition": {"__typename": "S3CreateDatasetDefinitionOutput", "datasetSourceType": "S3", "name": "tracks.csv", "description": null, "s3ExecutionContext": {"__typename": "S3ExecutionContext", "s3Uri": "s3://sagemaker-us-west-2-738335684114/music-recommendation/tracks.csv", "s3ContentType": "csv", "s3HasHeader": true}}}, "inputs": [], "outputs": [{"name": "default", "sampling": {"sampling_method": "sample_by_limit", "limit_rows": 50000}}]}, {"node_id": "892bbc66-6a4e-459e-b659-40e386600927", "type": "TRANSFORM", "operator": "sagemaker.spark.infer_and_cast_type_0.1", "parameters": {}, "trained_parameters": {"schema": {"trackId": "string", "length": "float", "energy": "float", "acousticness": "float", "valence": "float", "speechiness": "float", "instrumentalness": "float", "liveness": "float", "tempo": "float", "genre": "string"}}, "inputs": [{"name": "default", "node_id": "99823cc7-ddf7-4660-a279-efe1ab225ade", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "4b9554f0-0503-47e0-b488-5969b66c8f6f", "type": "SOURCE", "operator": "sagemaker.s3_source_0.1", "parameters": {"dataset_definition": {"__typename": "S3CreateDatasetDefinitionOutput", "datasetSourceType": "S3", "name": "ratings.csv", "description": null, "s3ExecutionContext": {"__typename": "S3ExecutionContext", "s3Uri": "s3://sagemaker-us-west-2-738335684114/music-recommendation/ratings.csv", "s3ContentType": "csv", "s3HasHeader": true}}}, "inputs": [], "outputs": [{"name": "default", "sampling": {"sampling_method": "sample_by_limit", "limit_rows": 50000}}]}, {"node_id": "8b7e0be2-7b25-4c06-82eb-c0547efebf67", "type": "TRANSFORM", "operator": "sagemaker.spark.infer_and_cast_type_0.1", "parameters": {}, "trained_parameters": {"schema": {"ratingEventId": "string", "ts": "long", "userId": "long", "trackId": "string", "sessionId": "long", "itemInSession": "long", "Rating": "float"}}, "inputs": [{"name": "default", "node_id": "4b9554f0-0503-47e0-b488-5969b66c8f6f", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "3ac7d3cd-1867-42a5-a8d9-19b30488146f", "type": "TRANSFORM", "operator": "sagemaker.spark.encode_categorical_0.1", "parameters": {"operator": "One-hot encode", "one_hot_encode_parameters": {"invalid_handling_strategy": "Keep", "drop_last": false, "output_style": "Columns", "input_column": "genre"}, "ordinal_encode_parameters": {"invalid_handling_strategy": "Replace with NaN"}}, "trained_parameters": {"one_hot_encode_parameters": {"_hash": -1767228197713558300, "string_indexer_model": "P)h>@6aWAK2mmUio>E#z_GjJz003hF000vJ003=ebYWy+bYU-WVRCdWFfcGMFm;a0PQx$|MfZHhtW(PoO;frpn=Yy%f!IbPdy+==t798cs{A`9NC*&Y@7#0lTtOL(5jNm?5ExJ$NyLDB64r>GFl8q3n0R!<&S`oj-g`|3DoCTHn9v5;)T{b#T`$*CwryL%%s&&y(Ys>46;j9r+Bdh5h0CKZ;SXh}<%(+6=w&0DQYk#zJr?s7Mi+A0dQ+Hz98)>_oW8O|Hgw8=Jaj~-4ei_unt9?x6kw`AQ;*rChi}q2uOC<wKV1Tqa?f<m<kaP!qWZP*|F2#5+52Oim_5TZ-Mj-(O9KQH0000804k)OQY|cT)(!vw01N;C02lxO0BvP-VPs)+VJ|LlVRCdWFfcGMFfL<qV@obdW?*1oVo3ky9t8kUO9KQH0000804k)OQX{Pd9M%B<0LlUY07w7;0AyiwVJ~oDa&#>)FfcGMEjD3hI5{>qV=ZDfGBPbRH(@g^Vl^}}EjDB^FlAw4I5lB3I4xr^FfcB2Zeeh6c`k5aa&dKKbd6HcYTGarmDSh@T^=@wf(?EMhLjdOFP>8`343YB#wcTiu!q4IMYiSCM3!AiZb?i2VPCL^J(c~)eqj&$n8``HbsdAf$oHOeuCC6()1#S>0Q#Y!@0yD`sx**chhTqa#*R(>m{vpp0N9PLPW|TVE`X}&=nZwgD(IrAzAuW3NxrNVZ?MdmX1gc&>S{;z>Jme1J|y!wCi<gKxNIqKT9l`=B3|sO`Xwc?<OR#(dVIYOL5sd_ixTt2sff==ju8Zh(0o8~M5s9894`?>1~_b(4VnqLp__z~oG^KxLhb%<vJXHPTDE2HwQSV3`UbGx-@SJ|bSwU&L9pBDeu3T3aIf|JUOtwsas#MNrj|fpxu#k0xra-v40vlV-UZ<zE10PV-oP6G^WZOqIH#T}&MP84UR-)PkvPE;o8Po+M=nd^OdKJ36-&o;(u~kVIFk?84#Rm(-SMILjsDjh-ojfu@BV|WcV%p@;J9ECXH2}UD0L?41!VOPkf{bolxzUkxwW8ntyUjbz&zO+e4O*%Hj$q1`2)}I?MGEclina5C+RRqNSa2YQJOqUM`0KyVGxe}(eP;y4ANm3CF29jwpHR!RP0mr7ykrMO9KQH0000804k)OQmu1pZ4v+g01yBG08Ib@0AyiwVJ|LlVRCdWFfcGMFfBG=W;i)EH)AbgHZn3TG&f;0En+n^GA%Y_F)(FeVmLKnG&n6|FfcGKb8ca9aCt6pVRCVGWpplMa$`#_N@ieSU}BiX)8KL5b5A}1P)h*<6ay3h000O8Dx{uLT1WP0-T(jqV*vmF6951J0000000000q=5hc003=ebYWy+bYU-WVRCdWFfcGMFi=YY0u%!j0000804k)OQY|cT)(!vw01N;C02lxO00000000000HlEr0RRAPWprU=VRT_HE^uLTbS*G2FfcGKV{&6qO928D0~7!N00;moq@GeEtpps_0RRBX0ssI=00000000000001_fl~nh0AyiwVJ~oDa&#>)FfcGMEjD3hI5{>qV=ZDfGBPbRH(@g^Vl^}}EjDB^FlAw4I5lB3I4xr^FfcB2Zeeh6c`k5aa&dKKbWlqH0u%!j0000804k)OQmu1pZ4v+g01yBG08Ib@00000000000HlGB0{{SIVRT_HE^uLTbS*G2FfcGJHeqHsIW{+AEn+q@GA%SWVKXgaH8e6UHe@j{Wnp4CHDNS3En_e+FfMa$VQ_GHE^uLTadl;ME@N_IP)h{{000001ONm8cmV(a3<LlG000", "one_hot_encoder_model": "P)h>@6aWAK2mmUio>Jtu8-&vU003zL000vJ003=ebYWy+bYU-WVRCdWFfcGMFm;Z*P6IIzMSDJD>WyXZ@<_HtNFWhGMQe?`vt)%|8ru{^`FDmOkWy^p;`-im<_OMXDKJ9fcZC_<fmF%JA1Zh?6V}G0ULrlF`Vd{3i1+e%=%6lvO2v?2G`D8AHP>6McZ2TWyniDuONv4slva9!;VW*m?AkI(c!9L$W-xbCuU&6?smLC~9))~_)M{?^K6x40N+Da9y!`<!@&Ds5mvrKkpRrUJXY_?SIAEMSJ;hJ-XEQM;hLbdD#^&qmifsKtYkzwew#sc?cDnioP)h>@6aWAK2mmUio>D&k<ckgf000aC000;O003=ebYWy+bYU+paA9(EEif=JFfcA-a$`#_N@ieSU}9*I-u?stP)h>@6aWAK2mmUio>Kc&^R9vc001xo002k;003lRbYU-WVRCdWFfcGMFfBG=H#ucAWi>51G-EX_G-5P2En;CZW-VhhH8x^1G-Y8iIA$$lFfcGKb8ca9aCt6pVRCVGWpsT~U2EGg6jih=Ev$X$gNzJ*2!e(bTw%|N>x4eEZ)J>8*1nZelvwJ_WIK_RjWiAHXY>d5hxF#7Wo0l4F8AY{d(RcRJpUdOL>TFW1cTEet$;Q^A%r&8L*2h3I0t7K><74DF<NB__P<{2*@-Ye@9g-8ECs=+kLmtcIC)>2`Bm{CEwpc;ev>wJVI2SnK16g!YFWz4ArJe3A9QvDXm;2_e)gWcCcT0Q_OSQp{b_V|PyeIU4`3e{v#LCL82KTkwYleFB0wZx>*c?su|-|cj|q=>gy_*f2s_mroaszDZtCB>luqQr3HsDnFgKq_He}YB+1Rm=sY2@9vf<5wRia##-mL+M4daa|j1hB4Z&$nCWQz(&(m;M(S56d_{WjB@4VBPVE<;v9Bt{ybFj$7{RTDH`E^n8Je%UHME=_y8Vmsz>#N&2%G%Ix8j?^Gmy(E`Pjj~MTCn`(RG*6Rs5NEy5NfN1EI?4w}eh|P5J~t4$gun6vP)h>@6aWAK2mmUio>I(v8uk(Z000mG002z@003lRbYU+paA9(EEif=JFfc7PVK+HtG-Wj{IW%K6Ei_^@H!WgeGG;AfG&MG2Gc;vkF*s%|V=yo<E^}^SaBz7paA9(Bb!BueV{&6lE=p!#U|?eC?BwG;_s_}<08mQ-0u%!j0000804k)OQslQAgwp^30BHdL022TJ00000000000HlEc0001OWprU=VRT_HaA9(EEif=JFfdR{0Rj{Q6aWAK2mmUio>D&k<ckgf000aC000;O0000000000005+c1OWg5ZDn*}WMOn+FD`Ila&#>)FfcGME@N_IP)h*<6ay3h000O8Dx{uL`&IL<f&l;kFaiJoNB{r;0000000000q=85Q003lRbYU-WVRCdWFfcGMFfBG=H#ucAWi>51G-EX_G-5P2En;CZW-VhhH8x^1G-Y8iIA$$lFfcGKb8ca9aCt6pVRCVGWpq$W0Rj{Q6aWAK2mmUio>I(v8uk(Z000mG002z@0000000000005+cFarPpWMOn+FD`Ila&#>)FfcGMEjD2{Ib}3uH7z+bV>K-_Vl+1`Vqr37En_q_Hexe0WnnQmW-VhdFfcB2Zeeh6c`k5aa&dKKbS`6ZV^B*41^@s600aO80C)ia0IdT60000"}}, "inputs": [{"name": "df", "node_id": "892bbc66-6a4e-459e-b659-40e386600927", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "fcf55a1d-8b85-4d7e-8232-9483de08f5fd", "type": "TRANSFORM", "operator": "sagemaker.spark.custom_pyspark_0.1", "parameters": {"code": "# Table is available as variable `df`\nfrom pyspark.sql import functions as F\ndf = df.withColumn('featureTimestamp', F.unix_timestamp(F.current_timestamp()))"}, "inputs": [{"name": "df", "node_id": "3ac7d3cd-1867-42a5-a8d9-19b30488146f", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "0841cef9-03b3-4dc8-bc01-9360e7d7f36e", "type": "TRANSFORM", "operator": "sagemaker.spark.cast_single_data_type_0.1", "parameters": {"column": "featureTimestamp", "original_data_type": "Long", "data_type": "float"}, "inputs": [{"name": "df", "node_id": "fcf55a1d-8b85-4d7e-8232-9483de08f5fd", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "d0d4f05a-3031-4438-867b-c5fd033d6c15", "type": "TRANSFORM", "operator": "sagemaker.spark.custom_formula_0.1", "parameters": {"output_column": "danceability", "formula": "0.3*valence + 0.1*liveness + 0.1*energy"}, "inputs": [{"name": "df", "node_id": "0841cef9-03b3-4dc8-bc01-9360e7d7f36e", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "9871838e-bc08-4377-ae70-d1b13c4044c4", "type": "TRANSFORM", "operator": "sagemaker.spark.join_tables_0.1", "parameters": {"left_column": "trackId", "right_column": "trackId", "join_type": "inner"}, "inputs": [{"name": "df", "node_id": "d0d4f05a-3031-4438-867b-c5fd033d6c15", "output_name": "default"}, {"name": "df", "node_id": "8b7e0be2-7b25-4c06-82eb-c0547efebf67", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "012229da-d789-4b90-a5cc-7f28c8bdbe58", "type": "TRANSFORM", "operator": "sagemaker.spark.manage_columns_0.1", "parameters": {"operator": "Drop column", "drop_column_parameters": {"column_to_drop": "trackId_1"}}, "inputs": [{"name": "df", "node_id": "9871838e-bc08-4377-ae70-d1b13c4044c4", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "65a4a88c-f641-4d03-a955-18d368a15ba7", "type": "TRANSFORM", "operator": "sagemaker.spark.manage_columns_0.1", "parameters": {"operator": "Rename column", "rename_column_parameters": {"input_column": "trackId_0", "new_name": "trackId"}, "drop_column_parameters": {}}, "inputs": [{"name": "df", "node_id": "012229da-d789-4b90-a5cc-7f28c8bdbe58", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "1be17c81-e08d-477e-8fc2-574dfd321c99", "type": "TRANSFORM", "operator": "sagemaker.spark.custom_pyspark_0.1", "parameters": {"code": "# Table is available as variable `df`\nimport pyspark.sql.functions as F\n\n# numeric features\nnum_feat_cols = ['energy', 'acousticness', 'valence', 'speechiness', 'instrumentalness', 'liveness', 'tempo', 'danceability', 'genre_Latin', 'genre_Folk',  'genre_Blues', 'genre_Rap', 'genre_Reggae', 'genre_Jazz', 'genre_RnB', 'genre_Country', 'genre_Electronic', 'genre_Pop_Rock']\n\n# calculate averages for 5-star ratings\nagg_obj = [F.avg(feat_col).alias(feat_col+\"_5star\") for feat_col in num_feat_cols]\ndf = df.filter(F.col('Rating')==5).groupBy('userId').agg(*agg_obj)\ndf = df.withColumn('featureTimestamp', F.unix_timestamp(F.current_timestamp()))"}, "inputs": [{"name": "df", "node_id": "65a4a88c-f641-4d03-a955-18d368a15ba7", "output_name": "default"}], "outputs": [{"name": "default"}]}, {"node_id": "3098f603-08d2-4319-83f5-55f509eeab60", "type": "TRANSFORM", "operator": "sagemaker.spark.cast_single_data_type_0.1", "parameters": {"column": "featureTimestamp", "original_data_type": "Long", "data_type": "float"}, "inputs": [{"name": "df", "node_id": "1be17c81-e08d-477e-8fc2-574dfd321c99", "output_name": "default"}], "outputs": [{"name": "default"}]}]}